function returnBackground(i){
	var bg = ["dark-bg", "tint-bg", "", "blue-bg"];
	return(bg[(i%4)]);
}
var dates = {
    convert:function(d) {
        // Converts the date in d to a date-object. The input can be:
        //   a date object: returned without modification
        //  an array      : Interpreted as [year,month,day]. NOTE: month is 0-11.
        //   a number     : Interpreted as number of milliseconds
        //                  since 1 Jan 1970 (a timestamp) 
        //   a string     : Any format supported by the javascript engine, like
        //                  "YYYY/MM/DD", "MM/DD/YYYY", "Jan 31 2009" etc.
        //  an object     : Interpreted as an object with year, month and date
        //                  attributes.  **NOTE** month is 0-11.
        return (
            d.constructor === Date ? d :
            d.constructor === Array ? new Date(d[0],d[1],d[2]) :
            d.constructor === Number ? new Date(d) :
            d.constructor === String ? new Date(d) :
            typeof d === "object" ? new Date(d.year,d.month,d.date) :
            NaN
        );
    },
    compare:function(a,b) {
        // Compare two dates (could be of any type supported by the convert
        // function above) and returns:
        //  -1 : if a < b
        //   0 : if a = b
        //   1 : if a > b
        // NaN : if a or b is an illegal date
        // NOTE: The code inside isFinite does an assignment (=).
        return (
            isFinite(a=this.convert(a).valueOf()) &&
            isFinite(b=this.convert(b).valueOf()) ?
            (a>b)-(a<b) :
            NaN
        );
    },
    inRange:function(d,start,end) {
        // Checks if date in d is between dates in start and end.
        // Returns a boolean or NaN:
        //    true  : if d is between start and end (inclusive)
        //    false : if d is before start or after end
        //    NaN   : if one or more of the dates is illegal.
        // NOTE: The code inside isFinite does an assignment (=).
       return (
            isFinite(d=this.convert(d).valueOf()) &&
            isFinite(start=this.convert(start).valueOf()) &&
            isFinite(end=this.convert(end).valueOf()) ?
            start <= d && d <= end :
            NaN
        );
    }
};
var CONTRACTS = [];
$(document).ready(function(){
	$("#printPilots").click(function(){
		$(".pilot_head").trigger("click");
		window.print();
	})
		$.ajax({
			type: "POST",
			url: "assets/php/checkAdmin.php",
			success: function(data){
				console.log(data);
				if(data != "false"){
					$('nav.fullnav ul, .mobile-nav').append("<li><a href=\"pilots.php\">Pilots</a></li><li><a href=\"contracts.php\">Contracts & Crafts</a></li>")
					$("#footerMenu").append("<a href='pilots.php'><button class='btn btn-default form-control'>Pilots</button></a><a href='contracts.php'><button class='btn btn-default form-control'>Contracts & Crafts</button></a>")
					//get pilot info
					$("#addPilotHeader").html("<div class=\"page-header\"><h2><span class=\"btn btn-danger\" data-toggle=\"modal\" data-target=\".addPilot\" style=\"margin-right: 15px;\">Add New Pilot</span><small>Add a new pilot to your fleet</small></h2></div>");
					$.ajax({
						type: "POST",
						url: "assets/php/get_pilot_info.php",
						success: function(response){
							if(response != "false" && response != "" && response != null){
								var res = JSON.parse(response);
								$("#username").text(res["fname"]+" "+res["lname"]);
							}
						}
					});

					// ADD PILOTS MODAL
					$("#addDates").click(function(e){
						e.stopPropagation();
						$("#onOffDates").append("<div class=\"addedDate\"><div class=\"col-md-6\"><div class=\"lbl\">On</div><input type=\"date\"  placeholder='YYYY-mm-dd' class=\"datepicker on-date\" /></div><div class=\"col-md-6\"><div class=\"lbl\">Off</div><input type=\"date\" class=\"datepicker off-date\"  placeholder='YYYY-mm-dd' /></div></div>")
						$("#removeDates").css("display", "inline-block");
					});
					$("#removeDates").click(function(e){
						e.stopPropagation();
						if($(".addedDate").length != 0){
							$(".addedDate").last().remove();
						}
						if($(".addedDate").length == 0){
							$(this).css("display", "none");
						}
					})

					$("#submitPilot").click(function(e){
						e.stopPropagation();
						var fname = $(".addPilot #fname").val();
						var lname = $(".addPilot #lname").val();
						var email = $(".addPilot #email").val();
						var nationality = $(".addPilot #nationality").val();
						var ang_license = $(".addPilot #ang_license").val();
						var position = $(".addPilot #comandante").val();
						var for_license = $(".addPilot #for_license").val();
						if(fname != "" && lname != "" && email != "" && nationality != "" && ang_license != "" && comandante != ""){
							var str = "";
							$(".addPilot input:not(.on-date, .off-date)").each(function(){
								if($(this).attr("id") == undefined){
									console.log($(this));
								}
								if($(this).val() != ""){
									str+=$(this).attr("id")+": '"+$(this).val()+"', ";
								}else{
									str+=$(this).attr("id")+": null, ";
								}
							});

							str+="comandante: '"+$(".addPilot #comandante").val()+"'";
							
							var inputs = eval("({"+str+"})");

							var onOffArray = [];
							for(var i = 0; i < $(".addPilot .on-date").length; i++){
								var on = $($(".addPilot .on-date")[i]).val();
								var off = $($(".addPilot .off-date")[i]).val();
								if(on != "" && off != ""){
									var temp ="({on: '"+on+"', off: '"+off+"'})";
									onOffArray.push(eval(temp));
								}
							}
							var selectedContracts = $("#pilotContracts select").val();
							var contractStr = "";
							if(selectedContracts != null){
								for(var i = 0; i < selectedContracts.length; i++){
									if(selectedContracts[i] != "none"){
										contractStr += selectedContracts+";";
									}
								}
							}

							$(".addPilot").modal("hide");
							$.ajax({
								type: "POST",
								url: "assets/php/create_new_pilot.php",
								data: {inputs: JSON.stringify(inputs), onOff: JSON.stringify(onOffArray), contracts: contractStr},
								success: function(r){
									console.log(r);
									if(r == "success"){
										$(".addPilot input").val("");
										$("#addedDate").remove();
										$("#notifications").append("<div class=\"col-md-5 center-block\" style=\"margin-left: auto; margin-right: auto;\">"+
											"<div class=\"alert_sec\"><div class=\"alert alert-success alert-dismissible\" role=\"alert\">"+
			  								"<button type=\"button\" class=\"close\" data-dismiss=\"alert\"><span aria-hidden=\"true\">&times;</span><span class=\"sr-only\">Close</span></button>"+
			  								"<strong>You have successfully added a pilot!</strong></div></div></div>");
									}else{
										$("#notifications").append("<div class=\"col-md-5 center-block\" style=\"margin-left: auto; margin-right: auto;\">"+
											"<div class=\"alert_sec\"><div class=\"alert alert-danger alert-dismissible\" role=\"alert\">"+
			  								"<button type=\"button\" class=\"close\" data-dismiss=\"alert\"><span aria-hidden=\"true\">&times;</span><span class=\"sr-only\">Close</span></button>"+
			  								"<strong>"+(r == "exists" ? "Pilot already exists" : "Adding the pilot failed. Please try again.")+"</strong></div></div></div>");
									}
								}
							});
						}else{
							$(".addPilot .modal-body").append("<div class=\"col-md-5 center-block\" style=\"margin-left: auto; margin-right: auto;\">"+
								"<div class=\"alert_sec\"><div class=\"alert alert-danger alert-dismissible\" role=\"alert\">"+
			  					"<button type=\"button\" class=\"close\" data-dismiss=\"alert\"><span aria-hidden=\"true\">&times;</span><span class=\"sr-only\">Close</span></button>"+
			  					"<strong>Please fill in all the required (*) information.</strong></div></div></div>");
						}
					})

					$.ajax({
						type: "GET",
						url: "assets/php/get_all_contracts.php",
						success: function(result){
							var res = JSON.parse(result);
							var contracts = [];
							for(var i = 0; i < res.length; i++){
								if(contracts.indexOf(res[i].contract) == -1){
									contracts[res[i].contract] = [];
									for(var j = 0; j < res.length; j++){
										if(res[j].craft == res[i].craft){
											var tempObj = {"class": res[j]["class"], "craft": res[j].craft, "craftid": res[j].craftid};
											contracts[res[i].contract].push(tempObj)
										}
									}
								}
							}
							CONTRACTS = contracts;
							$.ajax({
								type: "GET",
								url: "assets/php/get_all_pilots.php",
								success: function(data){
									console.log(data);
									var res = JSON.parse(data);
									console.log(res);
									for(var i = 0; i < res["id"].length; i++){
										//HEADER
										var head = "";
										var allValText = "FALSE";
										var valClass = "text-warning";
										if(res["allValid"][i]){
											valClass = "text-success";
											allValText = "True";
										}

										head += "<div class=\"pilot_head inner-left-sm inner-right-sm "+returnBackground(i)+"\" data-toggle=\"collapse\" data-target=\".pilot_info"+i+"\" data-name='"+res["lname"][i]+"' data-pos='"+res["comandante"][i]+"' data-id='"+i+"'>"+
											"<span>Name: <span class='personalInfo' data-pk='"+res["id"][i]+"' data-name='lname'>"+res["lname"][i]+"</span>, <span class='personalInfo' data-pk='"+res["id"][i]+"' data-name='fname'>"+res["fname"][i]+"</span></span><span>Email: <span class='personalInfo' data-pk='"+res["id"][i]+"' data-name='email'>"+res["email"][i]+"</span></span><span>Position: <span class='position' data-pk='"+res["id"][i]+"' data-name='comandante'>"+(res["comandante"][i] == 1 ? "Comandante" : "Piloto")+"</span></span>"
										
										var body = "";
										body += "<div class=\"pilot_info"+i+" more_info collapse inner-sm inner-left-sm inner-right-sm\"><div class='errors'></div>"


										var Now = new Date().getTime();
										var OnDuty = false;
										//ON OFF
										var onOffAr = res["onOff"][i];
										var onTbl = "<table class='table table-condensed table-bordered' style='-webkit-box-shadow: 0px 0px 0px 0px rgba(0,0,0,0); -moz-box-shadow: 0px 0px 0px 0px rgba(0,0,0,0); box-shadow: 0px 0px 0px 0px rgba(0,0,0,0);'><thead><th>On Duty</th><th>Off Duty</th><th>Scheduled</th></thead>";
										for(var o = 0; o < onOffAr.length; o++){
											if(onOffAr[o]["inSched"]){
												var inSchedStr = "<td class='active'>True</td><th></th></tr>";
												var oclss = "";
											}else{
												var inSchedStr = "<td class='info'>False</td><th class=\"text-center\"><div class=\"btn btn-sm btn-warning removeAvailDates\" data-id='"+res["id"][i]+"'>-</div></th></tr>";
												var oclss = "dateEditable";
											}
											onTbl += "<tr><td><span class='on-date "+oclss+"' data-name='on' data-pk='"+res["id"][i]+"'>"+onOffAr[o]["on"]+"</span></td><td><span class='off-date "+oclss+"' data-name='off' data-pk='"+res["id"][i]+"'>"+onOffAr[o]["off"]+"</span></td>"+inSchedStr;
											if(new Date(onOffAr[o]["on"]).getTime() <= Now && new Date(onOffAr[o]["off"]).getTime() >= Now){
												OnDuty = true;
											}
										}
										onTbl += "<tr id='addDateRow'><td><input type='date' placeholder='YYYY-mm-dd' class='on-date form-control' /></td><td><input type='date'  placeholder='YYYY-mm-dd' class='off-date form-control' /></td><td></td><th class=\"text-center\"><div class=\"btn btn-sm btn-primary addOnOffDate\" data-id='"+res["id"][i]+"'>+</div></th></tr>";
										onTbl += "</table><p class='outer-bottom-sm'><strong>NOTE: If the pilot is scheduled, their availability schedule cannot be changed.</strong></p>";
										body += onTbl;
										if(OnDuty){
											head += "<span><b><span class='text-success'>On Duty</span></b></span></div>"
										}else{
											head += "<span><b><span class='text-danger'>Off Duty</span></b></span></div>"
										}


										//VALIDITY TABLE
										var array = [[]];
										var counter = 0;
										var c = 0;
										for(var key in res["validity"][i]){
											if(key != "id"){
												array[c].push({header: key, val: res["validity"][i][key]})
												counter++;
												if(counter != 0 && counter%7 == 0){
													array.push([]);
													c++;
												}
											}	
										}

										var str = "";
										var headerStr, bodyStr;
										for(var k = 0; k < array.length; k++){
											headerStr = "<thead>";
											bodyStr = "<tr>";
											for(var j = 0; j < array[k].length; j++){
												headerStr += "<th>"+getTestName(array[k][j].header)+"</th>";
												if(array[k][j].val != null){
													var cur = new Date();
													var vald = new Date(array[k][j].val+"T12:00:00");
													var cls = "tint-bg";
													var dateStr = vald.getFullYear()+"-"+(vald.getMonth()+1)+"-"+vald.getDate()
													var content = "<span class='valText'>Valid</span><br/><span class='validityDate' data-type='date' data-name='"+array[k][j].header+"' data-pk='"+dateStr+"'>"+dateStr+"</span>";
													if(vald.getTime() < cur.getTime()){
														cls = "alert alert-danger"
														content = "<span class='valText'>EXPIRED</span><br/><span class='validityDate' data-type='date' data-name='"+array[k][j].header+"' data-pk='"+dateStr+"'>"+dateStr+"</span>";
													}else if(vald.getTime() - cur.getTime() <= (4*7*24*60*60*1000)){
														cls = "alert alert-warning";
														content = "<span class='valText'>Expires Soon</span><br/><span class='validityDate' data-type='date' data-name='"+array[k][j].header+"' data-pk='"+dateStr+"'>"+dateStr+"</span>";
													}
												}else{
													var cls = "alert-null";
													var content = "<span class='valText'>NOT DEFINED</span><br/><span class='validityDate' data-type='date' data-name='"+array[k][j].header+"' data-pk='holder'>Not defined</span>";
												}													
												bodyStr += "<td class='"+cls+"'>"+content+"</td>";
											}
											headerStr += "</thead>";
											bodyStr += "</tr>";
											str += "<table class='val_table'>"+headerStr+bodyStr+"</table>";
										}
										body += str;

										// console.log(CONTRACTS, res["contracts"][i]);
										if(res["contracts"][i] != null){
											var pilContracts = res["contracts"][i].split(";");
										}else{
											var pilContracts = [];
										}
										
										var contractStr = "<option value='none'>None</option>";
										for(key in CONTRACTS){
											if(i == 0){
												$("#pilotContracts select").append("<option value='"+key+"'>"+key+"</option>");
											}
											if(pilContracts.indexOf(key) != -1){
												contractStr += "<option value='"+key+"' selected>"+key+"</option>";
											}else{
												contractStr += "<option value='"+key+"'>"+key+"</option>";
											}
										}

										body += "<div class='col-md-6 center-block'><h3 class='page-header'>Pilot Contracts<button class='btn btn-primary pull-right saveContractList' data-pk='"+res["id"][i]+"'>Save</button></h3><select class='form-control' size='6' multiple>"+contractStr+"</select></div>"

										body += "<div class='col-md-3 center-block outer-top-xs'><button class='form-control btn btn-danger deletePilotBtn' data-pk='"+res["id"][i]+"'>Delete Pilot</button></div>";
										body+="</div>";
										$(".pilots").append("<div class='row center-block'>"+head+body+"</div>")
										$(".pilot_head[data-id=\""+i+"\"]").attr("data-onoff", (OnDuty ? 1 : 0));
									}

									$(".personalInfo").editable({
										type: "text",
										url: "assets/php/update_pilot.php",
										ajaxOptions: {
											type: "POST"
										},
										success: function(result){
											console.log(result);
										}
									});

									$(".position").editable({
										type: "select",
										source: [{text: "Comandante", value: 1}, {text: "Piloto", value: 0}],
										url: "assets/php/update_pilot.php",
										ajaxOptions: {
											type: "POST"
										},
										success: function(result){
											console.log(result);
										}
									});

									$("#sortBy").change(function(){
										switch($(this).val()){
											case "creation":
												sortByCreation(".pilots", ".pilots .row");
											break;
											case "name":
												sortByName(".pilots", ".pilots .row")
											break;
											case "position":
												sortByPosition(".pilots", ".pilots .row");
											break;
											case "duty":
												sortByOnOff(".pilots", ".pilots .row");
											break;
										}
									})

									$("#expandAccordion").click(function(){
										$(".pilot_head").each(function(){
											$(this).trigger("click");
										})
									});

									$(".deletePilotBtn").click(function(){
										var pilothead = $(".pilot_head[data-target='."+$(this).parents(".more_info").attr("class").split(" ")[0]+"']")
										var pilotbody = $(this).parents(".more_info");
										$.ajax({
											type: "POST",
											url: "assets/php/delete_pilot.php",
											data: {id: $(this).data("pk")},
											success: function(result){
												if(result == "success"){
													pilothead.remove();
													pilotbody.remove();
													$(".pilots").prepend("<div class=\"col-md-12 center-block\" style=\"margin-left: auto; margin-right: auto;\">"+
														"<div class=\"alert_sec\"><div class=\"alert alert-success alert-dismissible\" role=\"alert\">"+
						  								"<button type=\"button\" class=\"close\" data-dismiss=\"alert\"><span aria-hidden=\"true\">&times;</span><span class=\"sr-only\">Close</span></button>"+
						  								"<strong>Successfully deleted pilot!</strong></div></div></div>");
												}else{
													$(".pilots").prepend("<div class=\"col-md-12 center-block\" style=\"margin-left: auto; margin-right: auto;\">"+
														"<div class=\"alert_sec\"><div class=\"alert alert-danger alert-dismissible\" role=\"alert\">"+
						  								"<button type=\"button\" class=\"close\" data-dismiss=\"alert\"><span aria-hidden=\"true\">&times;</span><span class=\"sr-only\">Close</span></button>"+
						  								"<strong>Deleting the pilot was unsuccessful.</strong></div></div></div>");
												}
											}
										})
									});

									$(".saveContractList").click(function(){
										var conList = $(this).parent().next().val();
										var conStr = "";
										if(conList != null){
											for(var i = 0; i < conList.length; i++){
												if(conList[i] != "none"){
													conStr += conList[i]+";";
												}
											}
										}
										$.ajax({
											type: "POST",
											url: "assets/php/update_pilot_contracts.php",
											data: {uid: $(this).data("pk"), contracts: conStr},
											success: function(result){
												if(result == "success"){
													$("<div class=\"col-md-12 center-block\" style=\"margin-left: auto; margin-right: auto;\">"+
														"<div class=\"alert_sec\"><div class=\"alert alert-success alert-dismissible\" role=\"alert\">"+
						  								"<button type=\"button\" class=\"close\" data-dismiss=\"alert\"><span aria-hidden=\"true\">&times;</span><span class=\"sr-only\">Close</span></button>"+
						  								"<strong>Success!</strong></div></div></div>").insertAfter($(".saveContractList").parent());
												}else{
													$("<div class=\"col-md-12 center-block\" style=\"margin-left: auto; margin-right: auto;\">"+
														"<div class=\"alert_sec\"><div class=\"alert alert-danger alert-dismissible\" role=\"alert\">"+
						  								"<button type=\"button\" class=\"close\" data-dismiss=\"alert\"><span aria-hidden=\"true\">&times;</span><span class=\"sr-only\">Close</span></button>"+
						  								"<strong>Update was unsuccessful.</strong></div></div></div>").insertAfter($(".saveContractList").parent());
												}
											}
										})
									})


									$(".dateEditable").css("cursor", "pointer");
									$(".dateEditable").editable({
										type: "date",
										url: "assets/php/update_on_off.php",
										validate: function(value){
											var that = this;
											var input = new Date(value);
											console.log(input);
											var already;
											$(this).parents("tbody").children().each(function(){
												if($(this) != $(that).parent().parent()){
													console.log(input);
													var tempOn = new Date($(this).find(".on-date").text()+"T12:00:00");
													var tempOff = new Date($(this).find(".off-date").text()+"T12:00:00");
													console.log(tempOn, tempOff);
													if(dates.inRange(input, tempOn, tempOff)){
														already = true;
													}
												}
											});
											if(already){
												$(this).focus();
												$(this).parents(".more_info").find(".errors").prepend("<div class=\"col-md-12 center-block\" style=\"margin-left: auto; margin-right: auto;\">"+
														"<div class=\"alert_sec\"><div class=\"alert alert-danger alert-dismissible\" role=\"alert\">"+
						  								"<button type=\"button\" class=\"close\" data-dismiss=\"alert\"><span aria-hidden=\"true\">&times;</span><span class=\"sr-only\">Close</span></button>"+
						  								"<strong>Date ranges may not overlap. Your date is already scheduled.</strong></div></div></div>")
												return "Date ranges may not overlap. Your date is already scheduled.";
											}
										},
										params: function(params){
											params.on = $(this).parents("tr").find(".on-date").text(); 
											params.off = $(this).parents("tr").find(".off-date").text();
											return params
										},
										ajaxOptions: {
											type: "POST",
											cache: false
										},
										success: function(result){
											console.log(result);
										}
									})

									$(".addOnOffDate").click(function(e){
										e.stopPropagation();
										if($(this).parent().parent().find(".on-date").val() == ""){
											$(this).parent().parent().find(".on-date").focus();
										}else if($(this).parent().parent().find(".off-date").val() == ""){
											$(this).parent().parent().find(".off-date").focus();
										}else{
											var on = $(this).parent().parent().find(".on-date").val();
											var off = $(this).parent().parent().find(".off-date").val();
											var id = $(this).attr("data-id");
											var inputOn = new Date(on+"T12:00:00");
											var inputOff = new Date(off+"T12:00:00");
											var already = false, error = [];
											$(this).parents("tbody").children().each(function(){
												var tempOn = new Date($(this).find(".on-date").text()+"T12:00:00");
												var tempOff = new Date($(this).find(".off-date").text()+"T12:00:00");
												if(dates.inRange(inputOn, tempOn, tempOff)){
													error.push("<div class=\"col-md-12 center-block\" style=\"margin-left: auto; margin-right: auto;\">"+
													"<div class=\"alert_sec\"><div class=\"alert alert-danger alert-dismissible\" role=\"alert\">"+
					  								"<button type=\"button\" class=\"close\" data-dismiss=\"alert\"><span aria-hidden=\"true\">&times;</span><span class=\"sr-only\">Close</span></button>"+
					  								"<strong>Date ranges may not overlap. Your STARTING date is already scheduled.</strong></div></div></div>");
													already = true;
												}else if(dates.inRange(inputOff, tempOn, tempOff)){
													error.push("<div class=\"col-md-12 center-block\" style=\"margin-left: auto; margin-right: auto;\">"+
													"<div class=\"alert_sec\"><div class=\"alert alert-danger alert-dismissible\" role=\"alert\">"+
					  								"<button type=\"button\" class=\"close\" data-dismiss=\"alert\"><span aria-hidden=\"true\">&times;</span><span class=\"sr-only\">Close</span></button>"+
					  								"<strong>Date ranges may not overlap. Your ENDING date is already scheduled.</strong></div></div></div>");
													already = true;
												}
											});
											if(already){
												for(var el = 0; el < error.length; el++){
													$(this).parents(".more_info").find(".errors").prepend(error[el]);
												}
												return;
											}
											var that = this;
											$.ajax({
												type: "POST",
												url: "assets/php/insert_on_off.php",
												data: {id: id, on: on, off: off},
												cache: false,
												success: function(result){
													if(result == "success"){
														var rowstr = "<tr><td><span class='dateEditable on-date' data-name='off'>"+on+"</span></td><td><span class='dateEditable off-date'>"+off+"</span></td><td class='info'>False</td><th class=\"text-center\"><div class=\"btn btn-sm btn-warning removeAvailDates\" data-id='"+id+"'>-</div></th></tr>";
														$(rowstr).insertBefore($(that).parent().parent()); 


														$(".dateEditable").css("cursor", "pointer");
														$(".dateEditable").editable({
															type: "date",
															url: "assets/php/update_on_off.php"
														});
														$(".removeAvailDates").click(function(e){
															e.stopPropagation();

															var id = $(this).data("id");
															var on = $(this).parent().parent().find(".on-date").text();
															var off = $(this).parent().parent().find(".off-date").text();
															console.log(id,on,off);
															var that = this;
															$.ajax({
																type: "POST",
																url: "assets/php/remove_available.php",
																data: {id: id, on: on, off: off},
																success: function(result){
																	if(result == "success"){
																		$(that).parent().parent().remove();
																	}else{
																		$(that).parents(".more_info").find(".errors").prepend("<div class=\"col-md-12 center-block\" style=\"margin-left: auto; margin-right: auto;\">"+
																		"<div class=\"alert_sec\"><div class=\"alert alert-danger alert-dismissible\" role=\"alert\">"+
										  								"<button type=\"button\" class=\"close\" data-dismiss=\"alert\"><span aria-hidden=\"true\">&times;</span><span class=\"sr-only\">Close</span></button>"+
										  								"<strong>"+result+"</strong></div></div></div>");
																	}
																}
															})
														});
													}else{
														$(that).parents(".more_info").find(".errors").prepend("<div class=\"col-md-12 center-block\" style=\"margin-left: auto; margin-right: auto;\">"+
													"<div class=\"alert_sec\"><div class=\"alert alert-danger alert-dismissible\" role=\"alert\">"+
					  								"<button type=\"button\" class=\"close\" data-dismiss=\"alert\"><span aria-hidden=\"true\">&times;</span><span class=\"sr-only\">Close</span></button>"+
					  								"<strong>"+result+"</strong></div></div></div>");
													}
												}
											});
										}
									});

									$(".removeAvailDates").click(function(e){
										e.stopPropagation();

										var id = $(this).data("id");
										var on = $(this).parent().parent().find(".on-date").text();
										var off = $(this).parent().parent().find(".off-date").text();

										var that = this;
										$.ajax({
											type: "POST",
											url: "assets/php/remove_available.php",
											data: {id: id, on: on, off: off},
											success: function(result){
												if(result == "success"){
													$(that).parent().parent().remove();
												}else{
													$(that).parents(".more_info").find(".errors").prepend("<div class=\"col-md-12 center-block\" style=\"margin-left: auto; margin-right: auto;\">"+
													"<div class=\"alert_sec\"><div class=\"alert alert-danger alert-dismissible\" role=\"alert\">"+
					  								"<button type=\"button\" class=\"close\" data-dismiss=\"alert\"><span aria-hidden=\"true\">&times;</span><span class=\"sr-only\">Close</span></button>"+
					  								"<strong>"+result+"</strong></div></div></div>");
												}
											}
										})
									});


								}
							})
						}
					})
							

					$('#search_pilot').keyup(function(e){
						var input = $('#search_pilot').val().toLowerCase();
						$('.pilot_head').each(function(){
							console.log($(this).text())
							if($(this).text().toLowerCase().indexOf(input) >= 0){
								$(this).parent().show();
							}else{
								$(this).parent().hide();
							}
						});
					});
					$("#searchPilotSubmit").click(function(){
						$("#search_pilot").trigger("keyup");
					});
				}
			}
		});
			
});

function sortByName(parent, selector){
	var c = $(selector);
	c.sort(function(a,b){
		if($(a).find(".pilot_head").data("name") > $(b).find(".pilot_head").data("name")){
			return 1;
		}else if($(a).find(".pilot_head").data("name") < $(b).find(".pilot_head").data("name")){
			return -1;
		}
		return 0;
	});
	$(parent).empty();
	$(parent).html(c);
	applyBackground(c);
}
function sortByPosition(parent, selector){
	var c = $(selector);
	c.sort(function(a,b){
		if($(a).find(".pilot_head").data("pos") > $(b).find(".pilot_head").data("pos")){
			return -1;
		}else if($(a).find(".pilot_head").data("pos") < $(b).find(".pilot_head").data("pos")){
			return 1;
		}
		return 0;	
	});
	$(parent).empty();
	$(parent).html(c);
	applyBackground(c);
}
function sortByOnOff(parent, selector){
	var c = $(selector);
	c.sort(function(a,b){
		if($(a).find(".pilot_head").data("onoff") > $(b).find(".pilot_head").data("onoff")){
			return -1;
		}else if($(a).find(".pilot_head").data("onoff") < $(b).find(".pilot_head").data("onoff")){
			return 1;
		}
		return 0;	
	});
	$(parent).empty();
	$(parent).html(c);
	applyBackground(c);
}
function sortByCreation(parent, selector){
	var c = $(selector);
	c.sort(function(a,b){
		if($(a).find(".pilot_head").data("id") > $(b).find(".pilot_head").data("id")){
			return 1;
		}else if($(a).find(".pilot_head").data("id") < $(b).find(".pilot_head").data("id")){
			return -1;
		}
		return 0;	
	});
	$(parent).empty();
	$(parent).html(c);
	applyBackground(c);
}
function applyBackground(element){
	var bgs = "dark-bg tint-bg blue-bg";
	element.each(function(i, e){
		$(e).find(".pilot_head").removeClass(bgs);
		$(e).find(".pilot_head").addClass(returnBackground(i));
	})
}